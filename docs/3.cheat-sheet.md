# Composables Cheat Sheet

Quick reference for WPNuxt composables.

## Basic Usage

```typescript
// Standard - uses Suspense during navigation
const { data, pending, error } = usePosts();

// Lazy - no Suspense, instant navigation
const { data, pending, error } = useLazyPosts();
```

## With Parameters

```typescript
// Get post by ID
const { data: post } = usePostById({ id: "123" });

// Get post by URI
const { data: post } = usePostByUri({ uri: "/my-post" });

// Get posts by category
const { data: posts } = usePostsByCategoryName({
  categoryName: "news",
});

// Get menu
const { data: menu } = useMenu({ name: "main" });

// With pagination
const { data: posts } = usePosts({ first: 10 });
```

## Options

```typescript
// Client-only (skip SSR)
const { data } = usePosts(undefined, { server: false });

// Manual execution
const { data, execute } = usePosts(undefined, { immediate: false });
await execute();

// Watch reactive variable
const slug = ref("news");
const { data } = usePostsByCategoryName(
  { categoryName: slug },
  { watch: [slug] },
);

// Transform data
const { data: titles } = usePosts(undefined, {
  transform: (posts) => posts?.map((p) => p.title),
});
```

## Return Values

```typescript
const {
  data, // ComputedRef<T | undefined>
  pending, // Ref<boolean>
  error, // Ref<Error | undefined>
  status, // Ref<'idle' | 'pending' | 'success' | 'error'>
  refresh, // () => Promise<void>
  execute, // () => Promise<void>
  clear, // () => void
} = usePosts();
```

## Data Access

```typescript
// In <script setup>
const { data: posts } = usePosts()
console.log(posts.value) // Use .value

// In template
<template>
  <div>{{ posts }}</div> <!-- No .value needed -->
</template>
```

## Common Composables

### Posts

```typescript
usePosts() / useLazyPosts();
usePostById({ id }) / useLazyPostById({ id });
usePostByUri({ uri }) / useLazyPostByUri({ uri });
usePostsByCategoryName({ categoryName });
usePostsByCategoryId({ categoryId });
```

### Pages

```typescript
usePages() / useLazyPages();
usePageByUri({ uri }) / useLazyPageByUri({ uri });
usePageById({ id }) / useLazyPageById({ id });
```

### Other

```typescript
useMenu({ name }) / useLazyMenu({ name });
useNodeByUri({ uri }) / useLazyNodeByUri({ uri });
useGeneralSettings() / useLazyGeneralSettings();
useViewer() / useLazyViewer();
```

## Error Handling

```vue
<template>
  <div v-if="error">
    <p>{{ error.message }}</p>
    <button @click="refresh">Retry</button>
  </div>
  <div v-else-if="pending">Loading...</div>
  <div v-else>{{ data }}</div>
</template>
```

## Refreshing

```typescript
const { data, refresh, pending } = usePosts();

// Refresh data
await refresh();

// With loading state
async function handleRefresh() {
  await refresh();
  console.log("Refreshed!");
}
```

## Reactive Queries

```typescript
const route = useRoute();

// Auto-refresh when slug changes
const { data: post } = usePostByUri(
  { uri: route.params.slug },
  { watch: [() => route.params.slug] },
);
```

## TypeScript

```typescript
import type { PostFragment } from "#graphql-operations";

const { data: posts } = usePosts();
// posts: ComputedRef<PostFragment[] | undefined>
```

## When to Use What

| Scenario           | Use                                         |
| ------------------ | ------------------------------------------- |
| Critical content   | `usePosts()`                                |
| Below-fold content | `useLazyPosts()`                            |
| User-specific data | `usePosts(undefined, { server: false })`    |
| Manual trigger     | `usePosts(undefined, { immediate: false })` |
| Auto-refresh       | `usePosts(vars, { watch: [...] })`          |

## `await` Keyword

```typescript
// Both work identically (await is optional)
const { data } = await usePosts();
const { data } = usePosts();
```

## Quick Examples

### Blog Index

```vue
<script setup lang="ts">
const { data: posts, pending } = usePosts();
</script>

<template>
  <div v-if="pending">Loading posts...</div>
  <article v-for="post in posts" :key="post.id">
    <h2>{{ post.title }}</h2>
  </article>
</template>
```

### Single Post

```vue
<script setup lang="ts">
const route = useRoute();
const { data: post } = usePostByUri({
  uri: route.params.slug,
});
</script>

<template>
  <article v-if="post">
    <h1>{{ post.title }}</h1>
    <div v-html="post.content" />
  </article>
</template>
```

### Navigation Menu

```vue
<script setup lang="ts">
const { data: menuItems } = useMenu({ name: "main" });
</script>

<template>
  <nav>
    <NuxtLink v-for="item in menuItems" :key="item.id" :to="item.uri">
      {{ item.label }}
    </NuxtLink>
  </nav>
</template>
```

### Category Posts

```vue
<script setup lang="ts">
const route = useRoute();
const { data: posts } = usePostsByCategoryName({
  categoryName: route.params.category,
});
</script>

<template>
  <div>
    <h1>{{ route.params.category }}</h1>
    <PostCard v-for="post in posts" :key="post.id" :post="post" />
  </div>
</template>
```

## Links

- [Full Composables Guide](./1.getting-started/3.composables.md)
- [API Reference](./2.advanced/2.composables-api.md)
- [Migration from 1.x](/MIGRATION.md)
