---
title: Performance Optimization
description: Optimize performance with server-side caching
icon: i-ph-gauge
---

## Server-Side Caching

WPNuxt provides built-in server-side caching using Nitro's route rules. This caching layer sits between your Nuxt app and WordPress, dramatically improving response times.

### How It Works

```mermaid
graph LR
    A[Nuxt App] --> B{Nitro Cache}
    B -->|Cache Hit| C[Return Cached Data ~1-5ms]
    B -->|Cache Miss| D[WordPress GraphQL ~200-500ms]
    D --> E[Cache Response]
    E --> C
```

### Configuration

Enable caching in your `nuxt.config.ts`:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  wpNuxt: {
    wordpressUrl: "https://your-wordpress.com",
    cache: {
      enabled: true, // Enable server-side caching
      maxAge: 300, // Cache for 5 minutes
      swr: true, // Enable stale-while-revalidate
    },
  },
});
```

## Caching Strategies

### 1. Stale-While-Revalidate (SWR)

**Recommended for most use cases.**

With `swr: true`, Nitro:

1. Serves cached content immediately (even if stale)
2. Checks if cache needs refresh in the background
3. Updates cache for the next request

**Benefits:**

- ‚ö° Always fast responses
- üîÑ Content stays relatively fresh
- üìâ Better user experience

**Example:**

```ts
cache: {
  maxAge: 300,  // 5 minutes
  swr: true     // Enable SWR
}
```

**Timeline:**

```
Request 1 (t=0s):     WordPress ‚Üí Cache (500ms)
Request 2 (t=60s):    Cache ‚Üí User (2ms) ‚úì Fresh
Request 3 (t=300s):   Cache ‚Üí User (2ms) + Background Refresh ‚úì Stale but instant
Request 4 (t=301s):   Cache ‚Üí User (2ms) ‚úì Fresh again
```

### 2. Hard Cache

**For content that rarely changes.**

With `swr: false`, Nitro:

1. Serves from cache if valid
2. Fetches from WordPress if cache expired
3. User waits for WordPress response

**Use when:**

- Content is static (e.g., about pages, terms)
- Guaranteed fresh data is required
- Background requests are problematic

**Example:**

```ts
cache: {
  maxAge: 3600,  // 1 hour
  swr: false     // Wait for fresh data when cache expires
}
```

## Cache Duration Guidelines

Choose `maxAge` based on your content update frequency:

| Content Type       | Recommended maxAge | Example                   |
| ------------------ | ------------------ | ------------------------- |
| Real-time content  | `60` (1 min)       | Live scores, stock prices |
| Frequently updated | `300` (5 min)      | News, blog posts          |
| Moderately updated | `600` (10 min)     | Product listings          |
| Rarely updated     | `1800` (30 min)    | About pages, FAQs         |
| Static content     | `3600` (1 hour)    | Legal pages, terms        |

**Formula:**

```
maxAge = (acceptable_staleness_in_minutes * 60)
```

## Performance Benchmarks

Real-world performance comparison:

### Without Caching

```
First Request:     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 450ms
Second Request:    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 420ms
Third Request:     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 480ms
Average:           450ms
```

### With Caching (maxAge: 300, swr: true)

```
First Request:     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 450ms (cache miss)
Second Request:    ‚ñà 3ms (cache hit)
Third Request:     ‚ñà 2ms (cache hit)
After Expiry:      ‚ñà 2ms (stale + background refresh)
Average:           ~5ms (90x faster!)
```

## Monitoring Cache Performance

Enable debug mode to monitor caching:

```ts [nuxt.config.ts]
wpNuxt: {
  debug: true,
  cache: {
    enabled: true,
    maxAge: 300,
    swr: true
  }
}
```

Console output:

```bash
[wpnuxt] ‚öô Server-side caching enabled for GraphQL requests (maxAge: 300s, SWR: true)
```

## Advanced: Per-Route Caching

You can override cache settings for specific routes using Nitro route rules:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  // Global WPNuxt cache
  wpNuxt: {
    cache: {
      enabled: true,
      maxAge: 300, // 5 minutes default
      swr: true,
    },
  },

  // Override for specific routes
  nitro: {
    routeRules: {
      // Static pages: cache aggressively
      "/about": {
        cache: { maxAge: 3600, swr: true },
      },

      // Blog posts: moderate caching
      "/blog/**": {
        cache: { maxAge: 600, swr: true },
      },

      // Homepage: short cache
      "/": {
        cache: { maxAge: 60, swr: true },
      },
    },
  },
});
```

## Client-Side Caching

WPNuxt also benefits from `nuxt-graphql-middleware`'s client-side cache:

**Default Settings:**

- **Max Size:** 50 queries
- **Type:** In-memory LRU cache
- **Scope:** Per-browser session

This cache is automatic and works alongside server-side caching for optimal performance.

## Cache Invalidation

### Automatic Invalidation

Nitro automatically invalidates cache entries after `maxAge` seconds.

### Manual Invalidation

To clear cache during deployment or content updates:

1. **Restart your Nuxt app** - Clears all cached data
2. **Time-based expiry** - Wait for `maxAge` to expire
3. **Use SWR** - Background refresh handles updates

### Webhooks (Future)

Planned feature: WordPress webhook integration to invalidate cache on content updates.

## Best Practices

### ‚úÖ Do

- Enable caching in production
- Use SWR for better UX
- Set appropriate `maxAge` for your content
- Monitor cache hit rates
- Test cache behavior before deploying

### ‚ùå Don't

- Disable caching in production (unless necessary)
- Set `maxAge` too high for frequently updated content
- Disable SWR without good reason
- Cache authenticated content (future feature)
- Forget to test with cache enabled

## Troubleshooting

### Cache not working?

**Check:**

1. `cache.enabled` is `true`
2. You're accessing via server (not pure client-side navigation)
3. Debug mode shows "Server-side caching enabled"

### Seeing stale content?

**Solutions:**

1. Lower `maxAge` value
2. Disable `swr` if you need guaranteed fresh data
3. Restart your app to clear cache

### Performance not improving?

**Check:**

1. Verify cache is enabled
2. Ensure requests hit the server (not just client-side)
3. Check WordPress response times (might be the bottleneck)
4. Monitor cache hit rates in debug mode

## Summary

**Key Takeaways:**

- ‚úÖ Enable caching: `cache: { enabled: true }`
- ‚úÖ Use SWR: `swr: true`
- ‚úÖ Choose appropriate `maxAge` for your content
- ‚úÖ Monitor performance with `debug: true`
- ‚úÖ Test before deploying

**Expected Results:**

- 40-500x faster response times
- Better user experience
- Reduced WordPress server load
- Lower hosting costs

## Next Steps

- [Configuration Reference](/getting-started/configuration#server-side-caching)
- [Extending Queries](/getting-started/extending-queries)
