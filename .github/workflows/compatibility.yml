name: Compatibility Tests

on:
  workflow_dispatch:
    inputs:
      run_all:
        description: 'Run all combinations'
        required: false
        default: 'true'
        type: boolean
      wp_version:
        description: 'WordPress version'
        required: false
        default: '6.9'
        type: choice
        options:
          - '6.4'
          - '6.5'
          - '6.6'
          - '6.7'
          - '6.8'
          - '6.9'
      nuxt_version:
        description: 'Nuxt version'
        required: false
        default: '4'
        type: choice
        options:
          - '3.13'
          - '3'
          - '4.0'
          - '4.1'
          - '4.2'
          - '4.3'
          - 'srcdir'

jobs:
  # Full matrix - all combinations
  matrix:
    runs-on: ubuntu-latest
    name: WP ${{ matrix.wp_version }} + Nuxt ${{ matrix.nuxt_version }}
    if: inputs.run_all
    strategy:
      fail-fast: false
      matrix:
        wp_version: ['6.4', '6.5', '6.6', '6.7', '6.8', '6.9']
        nuxt_version: ['3.13', '3', '4.0', '4.1', '4.2', '4.3', 'srcdir']

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup WordPress and Run E2E Tests
        uses: ./.github/actions/setup-wp-e2e
        with:
          wp_version: ${{ matrix.wp_version }}
          nuxt_fixture: ${{ matrix.nuxt_version == '3.13' && 'nuxt313' || matrix.nuxt_version == '3' && 'nuxt3' || matrix.nuxt_version == '4.0' && 'nuxt40' || matrix.nuxt_version == '4.1' && 'nuxt41' || matrix.nuxt_version == '4.2' && 'nuxt42' || matrix.nuxt_version == 'srcdir' && 'nuxt-srcdir' || 'nuxt43' }}

  # Single combination - if manually specified
  single:
    runs-on: ubuntu-latest
    name: WP ${{ inputs.wp_version }} + Nuxt ${{ inputs.nuxt_version }}
    if: (!inputs.run_all) && inputs.wp_version != ''
    needs: []

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup WordPress and Run E2E Tests
        uses: ./.github/actions/setup-wp-e2e
        with:
          wp_version: ${{ inputs.wp_version }}
          nuxt_fixture: ${{ inputs.nuxt_version == '3.13' && 'nuxt313' || inputs.nuxt_version == '3' && 'nuxt3' || inputs.nuxt_version == '4.0' && 'nuxt40' || inputs.nuxt_version == '4.1' && 'nuxt41' || inputs.nuxt_version == '4.2' && 'nuxt42' || inputs.nuxt_version == 'srcdir' && 'nuxt-srcdir' || 'nuxt43' }}
